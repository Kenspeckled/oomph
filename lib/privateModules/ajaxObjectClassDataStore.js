// Generated by CoffeeScript 1.9.3
(function() {
  var AJAXClassMethods, Promise, ajax, httpRequest, url;

  Promise = require('promise');

  httpRequest = function(method, url, args, isJson) {
    return new Promise(function(resolve, reject) {
      var client, uri;
      client = new XMLHttpRequest;
      uri = url;
      if (args) {
        uri += '?';
        uri += _utilities.objectToQueryString(args);
      }
      console.log("Ajax request to " + uri);
      client.open(method, uri);
      client.send();
      client.onload = function() {
        if (this.status === 200) {
          if (isJson) {
            return resolve(JSON.parse(this.response));
          } else {
            return resolve(this.response);
          }
        } else {
          return reject(this.statusText);
        }
      };
      return client.onerror = function() {
        return reject(this.statusText);
      };
    });
  };

  if (typeof window === 'undefined') {
    url = '';
  } else {
    url = window.location.href.replace(window.location.pathname, '').replace(window.location.search, '');
  }

  ajax = {
    get: function(path, args) {
      return httpRequest('GET', path, args, true);
    },
    post: function(path, args) {
      return httpRequest('POST', path, args);
    },
    put: function(path, args) {
      return httpRequest('PUT', path, args);
    },
    "delete": function(path, args) {
      return httpRequest('DELETE', path, args);
    }
  };

  AJAXClassMethods = {
    moduleName: "AJAXClassMethods",
    all: function() {
      return ajax.get(this.indexPath);
    },
    find: function(id) {
      return ajax.get(this.showPath, {
        id: id
      });
    },
    findBy: function(opts) {
      return ajax.get(this.showPath, opts);
    },
    where: function(opts) {
      return ajax.get(this.indexPath, opts);
    },
    create: function(opts) {
      return ajax.post(this.createPath, opts);
    },
    update: function(id, opts) {
      return ajax.put(this.updatePath, opts);
    }
  };

  module.exports = AJAXClassMethods;

}).call(this);
